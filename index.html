<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Maisons ‚Äì Scores</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/countup.js/2.8.0/countUp.umd.min.js"></script>

  <style>
    :root{
      --c1:#F5B1ED; /* Aurion */
      --c2:#8FED9C; /* Esmeris */
      --c3:#FFB7B7; /* Rubrix */
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#f6f6f7;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
    }

    .wrap{ width:min(1100px, 100%); }

    .grid{
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:22px;
    }

    .card{
      border-radius:22px;
      overflow:hidden;
      box-shadow:0 18px 45px rgba(0,0,0,.10);
      position:relative;
      min-height:460px;
      display:flex;
      flex-direction:column;
      padding:26px;
      isolation:isolate;
      transition: transform .25s ease, box-shadow .25s ease;
    }

    .card::before{
      content:"";
      position:absolute;
      inset:0;
      opacity:.95;
      z-index:-2;
    }
    .card::after{
      content:"";
      position:absolute;
      width:520px;
      height:520px;
      border-radius:50%;
      filter: blur(40px);
      opacity:.35;
      z-index:-1;
      top:-260px;
      right:-260px;
      background:#000;
    }

    .c1::before{ background:var(--c1); }
    .c2::before{ background:var(--c2); }
    .c3::before{ background:var(--c3); }

    .top{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:12px;
      padding-top:6px;
    }

    .crest{
      width:200px;
      height:200px;
      object-fit:contain;
      filter: drop-shadow(0 14px 22px rgba(0,0,0,.22));
    }

    .name{
      font-weight:900;
      letter-spacing:3px;
      font-size:26px;
      text-transform:uppercase;
      margin-top:2px;
    }

    .score{
      margin-top:auto;
      text-align:center;
      font-weight:900;
      font-size:76px;
      letter-spacing:1px;
      line-height:1;
      padding:18px 16px;
      border-radius:18px;
      background:rgba(255,255,255,.35);
      backdrop-filter: blur(8px);
      border:1px solid rgba(255,255,255,.35);
      box-shadow:0 10px 25px rgba(0,0,0,.08);
    }

    .status{
      margin-top:14px;
      text-align:center;
      font-size:13px;
      opacity:.6;
      min-height:18px;
    }

    /* ====== LEADER STYLE ====== */
    .badge{
      position:absolute;
      top:16px;
      left:16px;
      padding:8px 12px;
      border-radius:999px;
      font-weight:900;
      letter-spacing:1px;
      font-size:12px;
      display:none;
      align-items:center;
      gap:8px;
      background:rgba(255,255,255,.55);
      backdrop-filter: blur(8px);
      border:1px solid rgba(255,255,255,.55);
      box-shadow:0 10px 25px rgba(0,0,0,.10);
    }

    .card.leader{
      box-shadow:0 26px 65px rgba(0,0,0,.16);
      transform: translateY(-6px);
      outline: 3px solid rgba(212,175,55,.9); /* dor√© */
      outline-offset: -6px;
    }
    .card.leader .badge{
      display:flex;
    }

    @keyframes leaderPulse{
      0%   { transform: translateY(-6px) scale(1); }
      50%  { transform: translateY(-6px) scale(1.015); }
      100% { transform: translateY(-6px) scale(1); }
    }
    .card.leader.pulse{
      animation: leaderPulse 1.1s ease-in-out infinite;
    }

    @media (max-width: 980px){
      .grid{ grid-template-columns:1fr; }
      .card{ min-height:unset; }
      .crest{ width:170px; height:170px; }
      .name{ font-size:24px; }
      .score{ font-size:66px; }
      .card.leader{ transform:none; }
      .card.leader.pulse{ animation:none; } /* √©vite l‚Äôeffet ‚Äúpompe‚Äù sur mobile */
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="grid">

      <div class="card c1" id="card1">
        <div class="badge">üëë EN T√äTE</div>
        <div class="top">
          <img class="crest" src="blason1.png" alt="Blason Aurion">
          <div class="name">Aurion</div>
        </div>
        <div id="score1" class="score">0</div>
        <div id="s1" class="status">Connexion‚Ä¶</div>
      </div>

      <div class="card c2" id="card2">
        <div class="badge">üëë EN T√äTE</div>
        <div class="top">
          <img class="crest" src="blason2.png" alt="Blason Esmeris">
          <div class="name">Esmeris</div>
        </div>
        <div id="score2" class="score">0</div>
        <div id="s2" class="status">Connexion‚Ä¶</div>
      </div>

      <div class="card c3" id="card3">
        <div class="badge">üëë EN T√äTE</div>
        <div class="top">
          <img class="crest" src="blason3.png" alt="Blason Rubrix">
          <div class="name">Rubrix</div>
        </div>
        <div id="score3" class="score">0</div>
        <div id="s3" class="status">Connexion‚Ä¶</div>
      </div>

    </div>
  </div>

<script>
  const SHEET_ID = "1AAyqYtidWn2S72nHS7-tnQzxmw3mb_hZQ0nv4sChCr4";
  const SHEET_NAME = "Maisons";
  const REFRESH_MS = 3000;

  const scores = [
    { el:"score1", card:"card1", col:"G", row:17, status:"s1" },
    { el:"score2", card:"card2", col:"I", row:17, status:"s2" },
    { el:"score3", card:"card3", col:"K", row:17, status:"s3" }
  ];

  function makeUrl(col,row){
    const range = `${col}${row}:${col}${row}`;
    const tq = encodeURIComponent(`select ${col}`);
    return `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME)}&range=${encodeURIComponent(range)}&tq=${tq}&tqx=out:json`;
  }

  const anims = {};
  const values = { score1: 0, score2: 0, score3: 0 };
  let leaderEl = null;

  scores.forEach(s=>{
    anims[s.el] = new countUp.CountUp(s.el, 0, { duration: 0.85, separator: " " });
  });

  function applyLeader(){
    // Trouver le max
    const entries = Object.entries(values); // [ ["score1", 7116], ...]
    const maxVal = Math.max(...entries.map(([,v]) => v));

    // Si √©galit√© : on ne met personne ‚Äúen t√™te‚Äù (option propre)
    const leaders = entries.filter(([,v]) => v === maxVal).map(([k]) => k);
    const newLeader = leaders.length === 1 ? leaders[0] : null;

    // Retirer l'ancien
    document.querySelectorAll(".card").forEach(c=>{
      c.classList.remove("leader","pulse");
    });

    if(!newLeader){
      leaderEl = null;
      return;
    }

    // Appliquer au nouveau leader
    const s = scores.find(x => x.el === newLeader);
    const card = document.getElementById(s.card);
    card.classList.add("leader","pulse");
    leaderEl = newLeader;
  }

  async function updateScore(s){
    const st = document.getElementById(s.status);
    try{
      const r = await fetch(makeUrl(s.col,s.row),{cache:"no-store"});
      const t = await r.text();
      const j = JSON.parse(t.substring(t.indexOf("{"),t.lastIndexOf("}")+1));
      const v = Number(j.table.rows[0].c[0].v);

      if(!Number.isFinite(v)){
        st.textContent = "Valeur non num√©rique";
        return;
      }

      if(v !== values[s.el]){
        anims[s.el].update(v);
        values[s.el] = v;
        st.textContent = "Mis √† jour";
        applyLeader();
      }else{
        st.textContent = "‚Äî";
      }
    }catch{
      st.textContent = "Erreur (partage/onglet/cellule)";
    }
  }

  function tick(){ scores.forEach(updateScore); }
  tick();
  setInterval(tick, REFRESH_MS);
</script>
</body>
</html>



