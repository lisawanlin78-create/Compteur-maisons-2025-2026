<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Maisons â€“ Scores</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/countup.js/2.8.0/countUp.umd.min.js"></script>

  <style>
    :root{
      --c1: #F5B1ED; /* Aurion */
      --c2: #8FED9C; /* Esmeris */
      --c3: #FFB7B7; /* Rubrix */
      --border: #111;
    }

    body{
      margin:0;
      font-family: system-ui, Arial, sans-serif;
      background:#f2f2f2;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      padding:20px;
    }

    .frame{
      width:min(1100px, 100%);
      background:#fff;
      border:3px solid var(--border);
      box-shadow:0 12px 30px rgba(0,0,0,.15);
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(3, 1fr);
    }

    .col{
      min-height:420px;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:30px 10px;
      border-right:3px solid var(--border);
    }
    .col:last-child{ border-right:none; }

    .c1{ background:var(--c1); }
    .c2{ background:var(--c2); }
    .c3{ background:var(--c3); }

    /* ðŸ”¥ BLASONS PLUS GRANDS */
    .crest{
      width:220px;
      height:220px;
      object-fit:contain;
      margin-bottom:20px;
      filter: drop-shadow(0 8px 14px rgba(0,0,0,.35));
    }

    /* ðŸ”¥ NOMS PLUS VISIBLES */
    .name{
      font-size:28px;
      font-weight:900;
      letter-spacing:2px;
      margin-bottom:auto;
    }

    .score{
      font-size:72px;
      font-weight:900;
      line-height:1;
      margin-top:24px;
    }

    .bottom{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      border-top:3px solid var(--border);
      background:#fff;
      font-size:14px;
      text-align:center;
    }
    .bottom div{
      padding:8px;
      border-right:3px solid var(--border);
      opacity:.7;
    }
    .bottom div:last-child{ border-right:none; }

    @media(max-width:900px){
      .grid{ grid-template-columns:1fr; }
      .col{
        border-right:none;
        border-bottom:3px solid var(--border);
        min-height:unset;
      }
      .col:last-child{ border-bottom:none; }
      .crest{ width:180px; height:180px; }
      .name{ font-size:24px; }
      .score{ font-size:64px; }
      .bottom{ grid-template-columns:1fr; }
      .bottom div{
        border-right:none;
        border-bottom:3px solid var(--border);
      }
      .bottom div:last-child{ border-bottom:none; }
    }
  </style>
</head>

<body>

<div class="frame">
  <div class="grid">
    <div class="col c1">
      <img class="crest" src="blason1.png" alt="Blason Aurion">
      <div class="name">AURION</div>
      <div id="score1" class="score">0</div>
    </div>

    <div class="col c2">
      <img class="crest" src="blason2.png" alt="Blason Esmeris">
      <div class="name">ESMERIS</div>
      <div id="score2" class="score">0</div>
    </div>

    <div class="col c3">
      <img class="crest" src="blason3.png" alt="Blason Rubrix">
      <div class="name">RUBRIX</div>
      <div id="score3" class="score">0</div>
    </div>
  </div>

  <div class="bottom">
    <div id="s1">Connexionâ€¦</div>
    <div id="s2">Connexionâ€¦</div>
    <div id="s3">Connexionâ€¦</div>
  </div>
</div>

<script>
  const SHEET_ID = "1AAyqYtidWn2S72nHS7-tnQzxmw3mb_hZQ0nv4sChCr4";
  const SHEET_NAME = "Maisons";
  const REFRESH_MS = 3000;

  const scores = [
    { el:"score1", col:"G", row:17, status:"s1" },
    { el:"score2", col:"I", row:17, status:"s2" },
    { el:"score3", col:"K", row:17, status:"s3" }
  ];

  function makeUrl(col,row){
    const range = `${col}${row}:${col}${row}`;
    const tq = encodeURIComponent(`select ${col}`);
    return `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME)}&range=${encodeURIComponent(range)}&tq=${tq}&tqx=out:json`;
  }

  const anims = {};
  scores.forEach(s=>{
    anims[s.el] = {
      current:0,
      anim:new countUp.CountUp(s.el,0,{duration:0.8,separator:" "})
    };
  });

  async function updateScore(s){
    const st = document.getElementById(s.status);
    try{
      const r = await fetch(makeUrl(s.col,s.row),{cache:"no-store"});
      const t = await r.text();
      const j = JSON.parse(t.substring(t.indexOf("{"),t.lastIndexOf("}")+1));
      const v = Number(j.table.rows[0].c[0].v);

      const a = anims[s.el];
      if(v !== a.current){
        a.anim.update(v);
        a.current = v;
        st.textContent = "Mis Ã  jour";
      }else{
        st.textContent = "â€”";
      }
    }catch{
      st.textContent = "Erreur";
    }
  }

  function tick(){ scores.forEach(updateScore); }
  tick();
  setInterval(tick, REFRESH_MS);
</script>

</body>
</html>


