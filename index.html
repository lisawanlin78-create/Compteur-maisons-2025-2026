<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scores – Maisons</title>

  <!-- Librairie d'animation des nombres -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/countup.js/2.8.0/countUp.umd.min.js"></script>

  <style>
    body{
      font-family: system-ui, Arial;
      margin:0;
      background:#f3f4f6;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      padding:16px;
    }
    .board{
      display:grid;
      grid-template-columns:repeat(3, minmax(220px, 1fr));
      gap:20px;
      width:min(980px, 100%);
    }
    .card{
      background:#fff;
      border-radius:16px;
      padding:24px;
      box-shadow:0 10px 30px rgba(0,0,0,.12);
      text-align:center;
    }
    .label{
      font-size:18px;
      opacity:.75;
      margin-bottom:10px;
    }
    .value{
      font-size:64px;
      font-weight:800;
      letter-spacing:1px;
      line-height:1;
    }
    .status{
      font-size:12px;
      opacity:.6;
      margin-top:10px;
      min-height:16px;
    }
    @media (max-width: 820px){
      .board{ grid-template-columns:1fr; }
      .value{ font-size:56px; }
    }
  </style>
</head>

<body>
  <div class="board">
    <div class="card">
      <div class="label">AURION</div>
      <div id="score1" class="value">0</div>
      <div id="s1" class="status">Connexion…</div>
    </div>

    <div class="card">
      <div class="label">ESMERIS</div>
      <div id="score2" class="value">0</div>
      <div id="s2" class="status">Connexion…</div>
    </div>

    <div class="card">
      <div class="label">RUBRIX</div>
      <div id="score3" class="value">0</div>
      <div id="s3" class="status">Connexion…</div>
    </div>
  </div>

<script>
  // ======= TES INFOS =======
  const SHEET_ID = "1AAyqYtidWn2S72nHS7-tnQzxmw3mb_hZQ0nv4sChCr4";
  const SHEET_NAME = "Maisons";
  const REFRESH_MS = 3000; // mise à jour toutes les 3 secondes

  // Tes zones : G17:H18 , I17:J18 , K17:L18
  // On lit la cellule en haut à gauche de chaque bloc : G17, I17, K17
  const scores = [
    { id: "score1", col: "G", row: 17, status: "s1" },
    { id: "score2", col: "I", row: 17, status: "s2" },
    { id: "score3", col: "K", row: 17, status: "s3" },
  ];

  // ======= AIDE : construit l'URL Google Sheets (sans clé API) =======
  function makeUrl(col, row){
    const range = `${col}${row}:${col}${row}`;
    const tq = encodeURIComponent(`select ${col}`);
    return `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME)}&range=${encodeURIComponent(range)}&tq=${tq}&tqx=out:json`;
  }

  // ======= Compteurs animés =======
  const counters = {};
  for (const s of scores){
    counters[s.id] = {
      current: 0,
      anim: new countUp.CountUp(s.id, 0, {
        duration: 0.8,
        separator: " "
      })
    };
  }

  async function updateScore(s){
    const statusEl = document.getElementById(s.status);

    try{
      const res = await fetch(makeUrl(s.col, s.row), { cache: "no-store" });
      const text = await res.text();

      // gviz renvoie du "pseudo json" entouré de texte -> on extrait l'objet JSON
      const jsonStr = text.substring(text.indexOf("{"), text.lastIndexOf("}") + 1);
      const data = JSON.parse(jsonStr);

      const raw = data?.table?.rows?.[0]?.c?.[0]?.v;
      const next = Number(raw);

      if (!Number.isFinite(next)) throw new Error("Valeur non numérique");

      const c = counters[s.id];
      if (next !== c.current){
        c.anim.update(next);
        c.current = next;
        statusEl.textContent = "Mis à jour";
      } else {
        statusEl.textContent = "—";
      }
    } catch (e){
      statusEl.textContent = "Erreur (partage / onglet / cellule / valeur)";
    }
  }

  function tick(){
    for (const s of scores) updateScore(s);
  }

  // init + refresh
  tick();
  setInterval(tick, REFRESH_MS);
</script>
</body>
</html>
