<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Maisons â€“ Scores</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/countup.js/2.8.0/countUp.umd.min.js"></script>

  <style>
    :root{
      --c1:#F5B1ED; /* Aurion */
      --c2:#8FED9C; /* Esmeris */
      --c3:#FFB7B7; /* Rubrix */
      --gold:#d4af37;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#f6f6f7;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:30px;
    }

    .wrap{
      width:min(1200px, 100%);
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:26px;
    }

    .card{
      position:relative;
      border-radius:26px;
      padding:22px;
      min-height:500px;
      display:flex;
      flex-direction:column;
      align-items:center;
      background:transparent;
      box-shadow:0 18px 40px rgba(0,0,0,.10);
      transition:transform .25s ease, box-shadow .25s ease;
    }

    /* fond couleur */
    .card::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:26px;
      z-index:-2;
    }
    .c1::before{ background:var(--c1); }
    .c2::before{ background:var(--c2); }
    .c3::before{ background:var(--c3); }

    /* halo clair (PAS noir) */
    .card::after{
      content:"";
      position:absolute;
      width:520px;
      height:520px;
      border-radius:50%;
      top:-280px;
      right:-280px;
      background:rgba(255,255,255,.9);
      filter:blur(55px);
      opacity:.22;
      z-index:-1;
    }

    /* badge leader */
    .badge{
      position:absolute;
      top:18px;
      left:18px;
      padding:8px 14px;
      border-radius:999px;
      font-size:12px;
      font-weight:900;
      letter-spacing:1px;
      background:rgba(255,255,255,.7);
      backdrop-filter:blur(8px);
      display:none;
    }

    .card.leader{
      transform:translateY(-8px);
      box-shadow:0 30px 70px rgba(0,0,0,.18);
      outline:3px solid var(--gold);
      outline-offset:-6px;
    }

    .card.leader .badge{
      display:block;
    }

    @keyframes leaderPulse{
      0%{ transform:translateY(-8px) scale(1); }
      50%{ transform:translateY(-8px) scale(1.02); }
      100%{ transform:translateY(-8px) scale(1); }
    }

    .card.leader.pulse{
      animation:leaderPulse 1.2s ease-in-out infinite;
    }

    /* blasons */
    .crest{
      width:280px;
      height:280px;
      object-fit:contain;
      margin-top:12px;
      filter:drop-shadow(0 10px 18px rgba(0,0,0,.14));
    }

    .name{
      margin-top:18px;
      font-size:28px;
      font-weight:900;
      letter-spacing:3px;
      text-transform:uppercase;
    }

    .score{
      margin-top:auto;
      font-size:78px;
      font-weight:900;
      letter-spacing:1px;
      padding:18px 26px;
      border-radius:20px;
      background:rgba(255,255,255,.35);
      backdrop-filter:blur(8px);
      box-shadow:0 8px 22px rgba(0,0,0,.08);
    }

    .status{
      margin-top:14px;
      font-size:13px;
      opacity:.6;
      min-height:16px;
    }

    @media(max-width:1000px){
      .grid{ grid-template-columns:1fr; }
      .crest{ width:230px; height:230px; }
      .score{ font-size:66px; }
      .card.leader{ transform:none; }
      .card.leader.pulse{ animation:none; }
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="grid">

    <div class="card c1" id="card1">
      <div class="badge">ðŸ‘‘ EN TÃŠTE</div>
      <img class="crest" src="blason1.png" alt="Aurion">
      <div class="name">Aurion</div>
      <div id="score1" class="score">0</div>
      <div id="s1" class="status">Connexionâ€¦</div>
    </div>

    <div class="card c2" id="card2">
      <div class="badge">ðŸ‘‘ EN TÃŠTE</div>
      <img class="crest" src="blason2.png" alt="Esmeris">
      <div class="name">Esmeris</div>
      <div id="score2" class="score">0</div>
      <div id="s2" class="status">Connexionâ€¦</div>
    </div>

    <div class="card c3" id="card3">
      <div class="badge">ðŸ‘‘ EN TÃŠTE</div>
      <img class="crest" src="blason3.png" alt="Rubrix">
      <div class="name">Rubrix</div>
      <div id="score3" class="score">0</div>
      <div id="s3" class="status">Connexionâ€¦</div>
    </div>

  </div>
</div>

<script>
  const SHEET_ID = "1AAyqYtidWn2S72nHS7-tnQzxmw3mb_hZQ0nv4sChCr4";
  const SHEET_NAME = "Maisons";
  const REFRESH_MS = 3000;

  const items = [
    { el:"score1", card:"card1", col:"G", row:17, status:"s1" },
    { el:"score2", card:"card2", col:"I", row:17, status:"s2" },
    { el:"score3", card:"card3", col:"K", row:17, status:"s3" }
  ];

  function makeUrl(col,row){
    const range = `${col}${row}:${col}${row}`;
    const tq = encodeURIComponent(`select ${col}`);
    return `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME)}&range=${encodeURIComponent(range)}&tq=${tq}&tqx=out:json`;
  }

  const anims = {};
  const values = {};
  items.forEach(i=>{
    anims[i.el] = new countUp.CountUp(i.el,0,{duration:0.9,separator:" "});
    values[i.el] = 0;
  });

  function applyLeader(){
    const max = Math.max(...Object.values(values));
    const leaders = Object.entries(values).filter(([,v])=>v===max).map(([k])=>k);

    document.querySelectorAll(".card").forEach(c=>{
      c.classList.remove("leader","pulse");
    });

    if(leaders.length===1){
      const item = items.find(i=>i.el===leaders[0]);
      const card = document.getElementById(item.card);
      card.classList.add("leader","pulse");
    }
  }

  async function updateOne(i){
    const st = document.getElementById(i.status);
    try{
      const r = await fetch(makeUrl(i.col,i.row),{cache:"no-store"});
      const t = await r.text();
      const j = JSON.parse(t.substring(t.indexOf("{"),t.lastIndexOf("}")+1));
      const v = Number(j.table.rows[0].c[0].v);

      if(Number.isFinite(v) && v!==values[i.el]){
        anims[i.el].update(v);
        values[i.el]=v;
        st.textContent="Mis Ã  jour";
        applyLeader();
      }else{
        st.textContent="â€”";
      }
    }catch{
      st.textContent="Erreur";
    }
  }

  function tick(){ items.forEach(updateOne); }
  tick();
  setInterval(tick, REFRESH_MS);
</script>
</body>
</html>


